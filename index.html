<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GTA 2 - PS1 Emulator</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      color: #ccc;
      font-family: Arial, sans-serif;
      height: 100%;
      overflow: hidden;
    }

    #emu {
      width: 100%;
      height: calc(100vh - 50px);
      background: black;
    }

    #controls {
      background: #1a1a1a;
      height: 50px;
      display: flex;
      align-items: center;
      padding: 0 10px;
      box-shadow: 0 0 10px #000;
    }

    #controls button {
      background: #333;
      border: none;
      color: #ccc;
      padding: 8px 12px;
      margin-right: 10px;
      border-radius: 4px;
      cursor: pointer;
    }

    #controls button:hover {
      background: #444;
    }
  </style>
</head>
<body>
  <div id="controls">
    <button onclick="toggleFullscreen()">Fullscreen</button>
    <button onclick="restartGame()">Restart</button>
    <button onclick="downloadSav()">Download Save</button>
    <button onclick="uploadSav()">Upload Save</button>
    <input type="file" id="saveInput" style="display: none;" />
  </div>

  <div id="emu"></div>

  <script>
    // Emulator config
    var NepPlayer = "#emu";
    var NepEmu = "psx";
    var NepLang = "en";
    var gameUrl = "https://hassannewcode.github.io/Gta-ChinaTown/grand-theft-auto-2.pbp";
    var EmuGbaBios = "enable";

    // Load NeptunJS
    const script = document.createElement("script");
    script.src = "https://mem.neptunjs.com/njs/njsLoader.js";
    document.body.appendChild(script);

    // Fullscreen toggle
    function toggleFullscreen() {
      const elem = document.getElementById("emu");
      if (!document.fullscreenElement) {
        elem.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    // Restart game
    function restartGame() {
      location.reload();
    }

    // Save state (basic)
    function downloadSav() {
      const save = localStorage.getItem("NJS_SAVE_" + gameUrl);
      if (save) {
        const blob = new Blob([save], { type: "application/octet-stream" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "gta2_save.sav";
        a.click();
      } else {
        alert("No save data found.");
      }
    }

    // Upload state
    function uploadSav() {
      document.getElementById("saveInput").click();
    }

    document.getElementById("saveInput").addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function () {
        localStorage.setItem("NJS_SAVE_" + gameUrl, reader.result);
        alert("Save uploaded! Refresh to load.");
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>
